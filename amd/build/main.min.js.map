{"version":3,"file":"main.min.js","sources":["../src/main.js"],"sourcesContent":["define([\n    'jquery',\n    'core/ajax',\n    'core/templates',\n    'core/notification',\n    'core/str',\n    'qrcode',\n], function($, Ajax, Templates, Notification, str, QRCode) {\n    return {\n        init: function(courseName, courseUrl, extendedHTML, ltiUrl, ltiCode, hasLti) {\n            this.courseName = courseName;\n            this.extendedHTML = extendedHTML;\n            this.ltiUrl = ltiUrl;\n            this.ltiCode = ltiCode;\n            this.hasLti = hasLti;\n            this.courseUrl = courseUrl;\n            this.encodedUrl = encodeURIComponent(courseUrl);\n\n            if (document.readyState === 'loading') {\n                document.addEventListener('DOMContentLoaded', this.moveMenuItem.bind(this));\n            } else {\n                this.moveMenuItem();\n            }\n        },\n        moveMenuItem: function() {\n            let shareItemLink = document.querySelector('li[data-key=\"sharecourse\"] a');\n            if (! shareItemLink) {\n                return;\n            }\n\n            // Clone the share link.\n            let shareItemClone = shareItemLink.cloneNode(true);\n            // Remove role and tabindex attributes\n            shareItemClone.removeAttribute('role');\n            shareItemClone.removeAttribute('tabindex');\n            // Modify the cloned link to be an info button with the fa-share icon.\n            shareItemClone.classList.remove('dropdown-item');\n            shareItemClone.classList.add('btn', 'btn-sm', 'btn-info', 'float-right', 'align-items-center', 'ml-3');\n            shareItemClone.style.height = 'fit-content';\n            shareItemClone.innerHTML = '<i class=\"fa fa-share mr-2\"></i> Share';\n\n            // Find the course title element and insert the cloned link next to it.\n            let courseTitle = document.querySelector('.page-header-headings');\n            if (courseTitle) {\n                courseTitle.parentNode.insertBefore(shareItemClone, courseTitle.nextSibling);\n            }\n\n            // Prevent default action and show modal.\n            shareItemClone.addEventListener('click', (event) => {\n                event.preventDefault();\n                this.showModal();\n            });\n            // Prevent default action and show modal.\n            shareItemLink.addEventListener('click', (event) => {\n                event.preventDefault();\n                this.showModal();\n            });\n        },\n        showModal: async function() {\n            // Check if the modal already exists\n            let existingModal = document.getElementById('shareModal');\n            if (existingModal) {\n                $('#shareModal').modal('show');\n                return;\n            }\n\n            let emailsubject = await str.get_string(\n                'share_email_subject',\n                'local_sharecourse',\n                {coursename: this.courseName}\n            );\n            let emailbody = await str.get_string(\n                'share_email_body',\n                'local_sharecourse',\n                {courseurl: this.courseUrl, coursename: this.courseName}\n            );\n\n            // Prepare the context data for the template\n            const context = {\n                courseurl: this.courseUrl,\n                encodedurl: this.encodedUrl,\n                extendedhtml: this.extendedHTML,\n                ltiurl: this.ltiUrl,\n                lticode: this.ltiCode,\n                haslti: this.hasLti,\n                emailsubject: emailsubject,\n                emailbody: encodeURIComponent(emailbody),\n            };\n\n            Templates.render('local_sharecourse/modal', context).done(function(html, js) {\n                // Append the modal to the body\n                document.body.insertAdjacentHTML('beforeend', html);\n                Templates.runTemplateJS(js);\n                $('#shareModal').modal('show');\n\n                // Generate QR code\n                let qrcodeContainer = document.getElementById('qrcode');\n                new QRCode(qrcodeContainer, {\n                    text: this.courseUrl,\n                    width: 256,\n                    height: 256,\n                });\n\n                // Handle event when copied button are clicked.\n                this.addCopyEventListener('copy-courseurl-button', this.courseUrl);\n                this.addCopyEventListener('copy-ltiurl-button', this.ltiUrl);\n                this.addCopyEventListener('copy-lticode-button', this.ltiCode);\n\n                // Trigger event when modal is loaded.\n                const event = new CustomEvent(\"shareModalLoaded\", { bubbles: true });\n                document.dispatchEvent(event);\n            }.bind(this)).fail(Notification.exception);\n        },\n        addCopyEventListener: function(buttonId, textToCopy) {\n            let button = document.getElementById(buttonId);\n\n            if (!button) {\n                return;\n            }\n\n            button.addEventListener('click', function() {\n                let copyButton = document.getElementById(buttonId);\n\n                navigator.clipboard.writeText(textToCopy).then(async function() {\n                    // Change tooltip text when copied.\n                    let copiedlabel = await str.get_string('copied_clipboard', 'local_sharecourse');\n                    copyButton.setAttribute('data-original-title', copiedlabel);\n                    $(copyButton).tooltip('show');\n                }).catch(Notification.exception);\n\n                // Reset tooltip title when the mouse leaves the button.\n                copyButton.addEventListener('mouseleave', async function() {\n                    let copylabel = await str.get_string('copy_clipboard', 'local_sharecourse');\n                    copyButton.setAttribute('data-original-title', copylabel);\n                    $(copyButton).tooltip('hide');\n                }, {once: true});\n            });\n        }\n    };\n});\n"],"names":["define","$","Ajax","Templates","Notification","str","QRCode","init","courseName","courseUrl","extendedHTML","ltiUrl","ltiCode","hasLti","this","encodedUrl","encodeURIComponent","document","readyState","addEventListener","moveMenuItem","bind","shareItemLink","querySelector","shareItemClone","cloneNode","removeAttribute","classList","remove","add","style","height","innerHTML","courseTitle","parentNode","insertBefore","nextSibling","event","preventDefault","showModal","async","getElementById","modal","emailsubject","get_string","coursename","emailbody","courseurl","context","encodedurl","extendedhtml","ltiurl","lticode","haslti","render","done","html","js","body","insertAdjacentHTML","runTemplateJS","qrcodeContainer","text","width","addCopyEventListener","CustomEvent","bubbles","dispatchEvent","fail","exception","buttonId","textToCopy","button","copyButton","navigator","clipboard","writeText","then","copiedlabel","setAttribute","tooltip","catch","copylabel","once"],"mappings":"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"}