define(["jquery","core/ajax","core/templates","core/str","qrcode"],(function(e,t,o,n,i){return{init:function(e,t,o,n,i,r){this.courseName=e,this.extendedHTML=o,this.ltiUrl=n,this.ltiCode=i,this.hasLti=r,this.courseUrl=t,this.encodedUrl=encodeURIComponent(t),"loading"===document.readyState?document.addEventListener("DOMContentLoaded",this.moveMenuItem.bind(this)):this.moveMenuItem()},moveMenuItem:function(){let e=document.querySelector('li[data-key="sharecourse"] a');if(!e)return;let t=e.cloneNode(!0);t.removeAttribute("role"),t.removeAttribute("tabindex"),t.classList.remove("dropdown-item"),t.classList.add("btn","btn-sm","btn-info","d-flex","align-items-center","ml-3"),t.style.height="fit-content",t.innerHTML='<i class="fa fa-share mr-2"></i> Share';let o=document.querySelector(".page-header-headings");o&&o.parentNode.insertBefore(t,o.nextSibling),t.addEventListener("click",(e=>{e.preventDefault(),this.showModal()})),e.addEventListener("click",(e=>{e.preventDefault(),this.showModal()}))},showModal:async function(){if(document.getElementById("shareModal"))return void e("#shareModal").modal("show");let t=await n.get_string("share_email_subject","local_sharecourse",{coursename:this.courseName}),r=await n.get_string("share_email_body","local_sharecourse",{courseurl:this.courseUrl,coursename:this.courseName});const s={courseurl:this.courseUrl,encodedurl:this.encodedUrl,extendedhtml:this.extendedHTML,ltiurl:this.ltiUrl,lticode:this.ltiCode,haslti:this.hasLti,emailsubject:t,emailbody:encodeURIComponent(r)};o.render("local_sharecourse/modal",s).done(function(t,n){document.body.insertAdjacentHTML("beforeend",t),o.runTemplateJS(n),e("#shareModal").modal("show");let r=document.getElementById("qrcode");new i(r,{text:this.courseUrl,width:256,height:256}),this.addCopyEventListener("copy-courseurl-button",this.courseUrl),this.addCopyEventListener("copy-ltiurl-button",this.ltiUrl),this.addCopyEventListener("copy-lticode-button",this.ltiCode);const s=new CustomEvent("shareModalLoaded",{bubbles:!0});document.dispatchEvent(s)}.bind(this)).fail((function(e){console.error("Failed to render template",e)}))},addCopyEventListener:function(t,o){button=document.getElementById(t),button&&button.addEventListener("click",(function(){let i=document.getElementById(t);navigator.clipboard.writeText(o).then((async function(){let t=await n.get_string("copied_clipboard","local_sharecourse");i.setAttribute("data-original-title",t),e(i).tooltip("show")})).catch((function(e){console.error("Could not copy text: ",e)})),i.addEventListener("mouseleave",(async function(){let t=await n.get_string("copy_clipboard","local_sharecourse");i.setAttribute("data-original-title",t),e(i).tooltip("hide")}),{once:!0})}))}}}));